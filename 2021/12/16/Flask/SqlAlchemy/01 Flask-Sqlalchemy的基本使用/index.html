<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Flask-Sqlalchemy的基本使用 | John Doe</title><meta name="keywords" content="Flask"><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、基本使用：1、环境的安装：12pip install flask-sqlalchemypip install pymysql  2：组件初始化：2.1： 基本的配置1: 首先先安装两个依赖的包。2：配置数据库的连接：app.config[‘SQLALCHEMY_DATABASE_URI’] = “mysql://root:&amp;#109;&amp;#x79;&amp;#x73;&amp;#113;&amp;#108;&amp;#64;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Flask-Sqlalchemy的基本使用">
<meta property="og:url" content="http://www.zhangxiaotao.live/2021/12/16/Flask/SqlAlchemy/01%20Flask-Sqlalchemy%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="John Doe">
<meta property="og:description" content="一、基本使用：1、环境的安装：12pip install flask-sqlalchemypip install pymysql  2：组件初始化：2.1： 基本的配置1: 首先先安装两个依赖的包。2：配置数据库的连接：app.config[‘SQLALCHEMY_DATABASE_URI’] = “mysql://root:&amp;#109;&amp;#x79;&amp;#x73;&amp;#113;&amp;#108;&amp;#64;&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img0.baidu.com/it/u=1259925066,3370431306&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG?w=819&amp;h=500">
<meta property="article:published_time" content="2021-12-16T07:54:00.000Z">
<meta property="article:modified_time" content="2022-07-01T06:58:11.057Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Flask">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img0.baidu.com/it/u=1259925066,3370431306&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG?w=819&amp;h=500"><link rel="shortcut icon" href="/img/avatar.png"><link rel="canonical" href="http://www.zhangxiaotao.live/2021/12/16/Flask/SqlAlchemy/01%20Flask-Sqlalchemy%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer=""></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"B0YYEXE704","apiKey":"df3b5032cce15f8c2fe870edf0ff7d98","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Flask-Sqlalchemy的基本使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-01 14:58:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mouse.css"><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><link rel="stylesheet" href="/css/copyright.css"><link rel="stylesheet" href="/css/modify.styl"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://picture-typora-bucket.oss-cn-shanghai.aliyuncs.com/typora/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">399</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">40</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">48</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/love/"><i class="fa-fw fas fa-gift"></i><span> Love</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">John Doe</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/love/"><i class="fa-fw fas fa-gift"></i><span> Love</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Flask-Sqlalchemy的基本使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-16T07:54:00.000Z" title="发表于 2021-12-16 15:54:00">2021-12-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-01T06:58:11.057Z" title="更新于 2022-07-01 14:58:11">2022-07-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Flask/">Flask</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Flask/Flask-Sqlalchemy/">Flask-Sqlalchemy</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Flask-Sqlalchemy的基本使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、基本使用："><a href="#一、基本使用：" class="headerlink" title="一、基本使用："></a>一、基本使用：</h2><h3 id="1、环境的安装："><a href="#1、环境的安装：" class="headerlink" title="1、环境的安装："></a>1、环境的安装：</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-sqlalchemy</span><br><span class="line">pip install pymysql</span><br></pre></td></tr></tbody></table></figure>

<p>2：组件初始化：<br>2.1： 基本的配置<br>1: 首先先安装两个依赖的包。<br>2：配置数据库的连接：app.config[‘SQLALCHEMY_DATABASE_URI’] = “mysql://root:<a href="mailto:mysql@192.168.44.128">mysql@192.168.44.128</a>:3306/test39”<br>3：关闭数据库的跟踪：app.config[‘SQLALCHEMY_TRACK_MODIFICATIONS’] = False<br>4：开启输出sql语句：app.config[‘SQLALCHEMY_ECHO’] = True<br>5：两种处理python2和python3的名字不一致问题。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Api, Resource</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">python2中数据库客户端： MySqldb</span></span><br><span class="line"><span class="string">python3中数据库客户端：pymysql</span></span><br><span class="line"><span class="string">解决方案一：让python2和python3的包进行转换。</span></span><br><span class="line"><span class="string">import pymysql</span></span><br><span class="line"><span class="string">pymysql.install_as_MySQLdb()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">方案二：表示只使用python3的包，不使用python2的包</span></span><br><span class="line"><span class="string">app.config['SQLALCHEMY_DATABASE_URI'] = "mysql+pymysql://root:mysql@192.168.44.128:3306/test39"</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># app.config['SQLALCHEMY_DATABASE_URI'] = "mysql://账号:密码@数据库ip地址:端口号/数据库名"</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">"mysql://root:mysql@192.168.44.128:3306/test39"</span></span><br><span class="line"><span class="comment"># app.config['SQLALCHEMY_BINDS'] = {}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库修改跟踪操作[提高性能]：</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启输出底层执行的sql语句</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_ECHO'</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启数据库的自动提交功能[一般不使用]</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_COMMIT_ON_TEARDOWN'</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_word</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello, word"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="built_in">print</span>(app.url_map)</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port= <span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2.2：结合工厂方法进行配置：<br>1： 数据库配置信息存放在环境类中加载。<br>2：由于数据库对象和app对象不一定谁先创建，所以可以先创建数据库对象，等app对象创建之后再进行关联。<br>3：进行关联的函数是：数据库对象调用自己的init_app()方法。需要传入app对象。<br>settings中配置：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开发环境</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DevelopmentConfig</span>(<span class="params">BaseConfig</span>):</span></span><br><span class="line">    <span class="string">"""开发环境配置类"""</span></span><br><span class="line">    DEBUG = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># SQL数据库连接信息</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">"mysql+pymysql://root:mysql@192.168.243.157:3306/test39"</span></span><br><span class="line">    <span class="comment"># 关闭数据库修改跟踪操作 【提高性能】</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 开启输出底层执行sql语句</span></span><br><span class="line">    SQLALCHEMY_ECHO = <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure>

<p>主模块：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response, Response, request, current_app</span><br><span class="line"><span class="keyword">from</span> settings <span class="keyword">import</span> config_dict</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 延后加载</span></span><br><span class="line"><span class="comment"># 创建了数据库，此时数据库对象还没有跟app关联</span></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个工厂方法：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span>(<span class="params">config_name</span>):</span></span><br><span class="line">    app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">    config_class = config_dict[config_name]</span><br><span class="line">    app.config.from_object(config_class)</span><br><span class="line"></span><br><span class="line">    app.config.from_envvar(<span class="string">'CONFIG'</span>, silent=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 懒加载</span></span><br><span class="line">    db.init_app(app)</span><br><span class="line">    <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line">app = create_app(<span class="string">"dev"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/login'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3：构建模型类：<br>模型类必须继承 db.Model, 其中 db 指对应的组件对象<br>表名默认为类名小写, 可以通过 __tablename__类属性 进行修改<br>类属性对应字段, 必须是通过 db.Column() 创建的对象<br>可以通过 create_all() 和 drop_all()方法 来创建和删除所有模型类对应的表<br>注意点: 如果没有给对应字段的类属性设置default参数, 且添加数据时也没有给该字段赋值, 则 sqlalchemy会给该字段设置默认值 None<br>&lt;模型类创建案例&gt;</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相关配置</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">"mysql://root:mysql@192.168.44.128:3306/test39"</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="literal">False</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_ECHO'</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建组件对象</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建模型类  类-&gt;表  类属性-&gt;字段  实例对象-&gt;记录</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">'t_user'</span>  <span class="comment"># 设置表名, 表名默认为类名小写</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)  <span class="comment"># 设置主键, 默认自增</span></span><br><span class="line">    name = db.Column(<span class="string">'username'</span>, db.String(<span class="number">20</span>), unique=<span class="literal">True</span>)  <span class="comment"># 设置字段名 和 唯一约束</span></span><br><span class="line">    age = db.Column(db.Integer, default=<span class="number">10</span>, index=<span class="literal">True</span>)  <span class="comment"># 设置默认值约束 和 索引</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 删除所有继承自db.Model的表</span></span><br><span class="line">    db.drop_all()</span><br><span class="line">    <span class="comment"># 创建所有继承自db.Model的表</span></span><br><span class="line">    db.create_all()</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="二、数据操作："><a href="#二、数据操作：" class="headerlink" title="二、数据操作："></a>二、数据操作：</h2><h3 id="1-1、增加数据："><a href="#1-1、增加数据：" class="headerlink" title="1.1、增加数据："></a>1.1、增加数据：</h3><p>1：给模型对象设置数据 可以通过 初始化参数 或者 赋值属性 两种方式<br>2：session.add(模型对象) 添加单条数据到会话中, session.add_all(列表) 添加多条数据到会话中<br>3：sqlalchemy 会 自动创建事务, 并将数据操作包含在事务中, 提交会话时就会提交事务，事务提交失败会自动回滚。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相关配置</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">"mysql://root:mysql@192.168.44.128:3306/test39"</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="literal">False</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_ECHO'</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建组件对象</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建模型类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">'t_user'</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(<span class="string">'username'</span>, db.String(<span class="number">20</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    age = db.Column(db.Integer, index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="string">"""增加数据"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.创建模型对象</span></span><br><span class="line">    user1 = User(name=<span class="string">'zs'</span>, age=<span class="number">20</span>)</span><br><span class="line">    <span class="comment"># user1.name = 'zs'</span></span><br><span class="line">    <span class="comment"># user1.age = 20</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.将模型对象添加到会话中</span></span><br><span class="line">    db.session.add(user1)</span><br><span class="line">    <span class="comment"># 添加多条记录</span></span><br><span class="line">    <span class="comment"># db.session.add_all([user1, user2, user3])</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.提交会话 (会提交事务)</span></span><br><span class="line">    <span class="comment"># sqlalchemy会自动创建隐式事务</span></span><br><span class="line">    <span class="comment"># 事务失败会自动回滚</span></span><br><span class="line">    db.session.commit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"index"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    db.drop_all()</span><br><span class="line">    db.create_all()</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="1-2、批量增加数据："><a href="#1-2、批量增加数据：" class="headerlink" title="1.2、批量增加数据："></a>1.2、批量增加数据：</h3><h4 id="第一种方法："><a href="#第一种方法：" class="headerlink" title="第一种方法："></a>第一种方法：</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line"></span><br><span class="line">objects = [</span><br><span class="line">    User(name=<span class="string">"u1"</span>),</span><br><span class="line">    User(name=<span class="string">"u2"</span>),</span><br><span class="line">    User(name=<span class="string">"u3"</span>)]</span><br><span class="line">db.session.bulk_save_objects(objects)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="第二种方法："><a href="#第二种方法：" class="headerlink" title="第二种方法："></a>第二种方法：</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line"></span><br><span class="line">objects = [User(name=<span class="string">"u1"</span>), User(name=<span class="string">"u2"</span>), User(name=<span class="string">"u3"</span>)]</span><br><span class="line">db.session.add_all(objects)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2、查询数据："><a href="#2、查询数据：" class="headerlink" title="2、查询数据："></a>2、查询数据：</h3><p><img src="https://picture-typora-bucket.oss-cn-shanghai.aliyuncs.com/typora/image-20220306171808129.png" alt="image-20220306171808129"></p>
<p><img src="https://picture-typora-bucket.oss-cn-shanghai.aliyuncs.com/typora/image-20220306171818797.png" alt="image-20220306171818797"></p>
<h4 id="数据的准备工作"><a href="#数据的准备工作" class="headerlink" title="数据的准备工作"></a>数据的准备工作</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置数据库连接</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">"mysql://root:mysql@192.168.44.128:3306/test39"</span></span><br><span class="line"><span class="comment"># 配置取消数据库跟踪</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 配置数据库输出SQL语句</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_ECHO'</span>] = <span class="literal">True</span></span><br><span class="line"><span class="comment"># 创建数据库对象</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    <span class="comment"># 指定表名：默认使用类名小写</span></span><br><span class="line">    __tablename__ = <span class="string">"users"</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">64</span>))</span><br><span class="line">    email = db.Column(db.String(<span class="number">64</span>))</span><br><span class="line">    age = db.Column(db.Integer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"(%s, %s, %s, %s)"</span>%(self.<span class="built_in">id</span>, self.name, self.email, self.age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 删除所有表</span></span><br><span class="line">    <span class="comment"># db.drop_all()</span></span><br><span class="line">    <span class="comment"># # 创建所有表</span></span><br><span class="line">    <span class="comment"># db.create_all()</span></span><br><span class="line">    <span class="comment"># # 添加测试数据</span></span><br><span class="line">    <span class="comment"># user1 = User(name='wang', email='wang@163.com', age=20)</span></span><br><span class="line">    <span class="comment"># user2 = User(name='zhang', email='zhang@189.com', age=33)</span></span><br><span class="line">    <span class="comment"># user3 = User(name='chen', email='chen@126.com', age=23)</span></span><br><span class="line">    <span class="comment"># user4 = User(name='zhou', email='zhou@163.com', age=29)</span></span><br><span class="line">    <span class="comment"># user5 = User(name='tang', email='tang@itheima.com', age=25)</span></span><br><span class="line">    <span class="comment"># user6 = User(name='wu', email='wu@gmail.com', age=25)</span></span><br><span class="line">    <span class="comment"># user7 = User(name='qian', email='qian@gmail.com', age=23)</span></span><br><span class="line">    <span class="comment"># user8 = User(name='liu', email='liu@itheima.com', age=30)</span></span><br><span class="line">    <span class="comment"># user9 = User(name='li', email='li@163.com', age=28)</span></span><br><span class="line">    <span class="comment"># user10 = User(name='sun', email='sun@163.com', age=26)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 一次添加多条数据</span></span><br><span class="line">    <span class="comment"># db.session.add_all([user1, user2, user3, user4, user5, user6, user7, user8, user9, user10])</span></span><br><span class="line">    <span class="comment"># db.session.commit()</span></span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>,port=<span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="进行查询操作"><a href="#进行查询操作" class="headerlink" title="进行查询操作"></a>进行查询操作</h4><h5 id="查询-filter-by精确查询"><a href="#查询-filter-by精确查询" class="headerlink" title="查询:filter_by精确查询"></a>查询:filter_by精确查询</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">返回名字等于wang的所有人</span><br><span class="line"></span><br><span class="line">User.query.filter_by(name=<span class="string">'wang'</span>).<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="first-返回查询到的第一个对象"><a href="#first-返回查询到的第一个对象" class="headerlink" title="first()返回查询到的第一个对象"></a>first()返回查询到的第一个对象</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.first()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="all-返回查询到的所有对象"><a href="#all-返回查询到的所有对象" class="headerlink" title="all()返回查询到的所有对象"></a>all()返回查询到的所有对象</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="filter模糊查询，返回名字结尾字符为g的所有数据。"><a href="#filter模糊查询，返回名字结尾字符为g的所有数据。" class="headerlink" title="filter模糊查询，返回名字结尾字符为g的所有数据。"></a>filter模糊查询，返回名字结尾字符为g的所有数据。</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.<span class="built_in">filter</span>(User.name.endswith(<span class="string">'g'</span>)).<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="get-，参数为主键，如果主键不存在没有返回内容"><a href="#get-，参数为主键，如果主键不存在没有返回内容" class="headerlink" title="get()，参数为主键，如果主键不存在没有返回内容"></a>get()，参数为主键，如果主键不存在没有返回内容</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.get()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="逻辑非，返回名字不等于wang的所有数据。"><a href="#逻辑非，返回名字不等于wang的所有数据。" class="headerlink" title="逻辑非，返回名字不等于wang的所有数据。"></a>逻辑非，返回名字不等于wang的所有数据。</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.<span class="built_in">filter</span>(User.name!=<span class="string">'wang'</span>).<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="逻辑与，需要导入and，返回and-条件满足的所有数据。"><a href="#逻辑与，需要导入and，返回and-条件满足的所有数据。" class="headerlink" title="逻辑与，需要导入and，返回and()条件满足的所有数据。"></a>逻辑与，需要导入and，返回and()条件满足的所有数据。</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> and_</span><br><span class="line">User.query.<span class="built_in">filter</span>(and_(User.name!=<span class="string">'wang'</span>,User.email.endswith(<span class="string">'163.com'</span>))).<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="逻辑或，需要导入or"><a href="#逻辑或，需要导入or" class="headerlink" title="逻辑或，需要导入or_"></a>逻辑或，需要导入or_</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> or_</span><br><span class="line">User.query.<span class="built_in">filter</span>(or_(User.name!=<span class="string">'wang'</span>,User.email.endswith(<span class="string">'163.com'</span>))).<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="not-相当于取反"><a href="#not-相当于取反" class="headerlink" title="not_ 相当于取反"></a>not_ 相当于取反</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> not_</span><br><span class="line">User.query.<span class="built_in">filter</span>(not_(User.name==<span class="string">'chen'</span>)).<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="查询数据后删除"><a href="#查询数据后删除" class="headerlink" title="查询数据后删除"></a>查询数据后删除</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = User.query.first()</span><br><span class="line">db.session.delete(user)</span><br><span class="line">db.session.commit()</span><br><span class="line">User.query.<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = User.query.first()</span><br><span class="line">user.name = <span class="string">'dong'</span></span><br><span class="line">db.session.commit()</span><br><span class="line">User.query.first()</span><br></pre></td></tr></tbody></table></figure>

<h5 id="使用update"><a href="#使用update" class="headerlink" title="使用update"></a>使用update</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.query.filter_by(name=<span class="string">'zhang'</span>).update({<span class="string">'name'</span>:<span class="string">'li'</span>})</span><br></pre></td></tr></tbody></table></figure>

<h3 id="3、修改数据："><a href="#3、修改数据：" class="headerlink" title="3、修改数据："></a>3、修改数据：</h3><ul>
<li>1: 推荐采用方案二：</li>
<li>2: 一条语句, 被网络IO影响程度低, 执行效率更高</li>
<li>3：查询和更新在一条语句中完成, 单条SQL具有原子性, 不会出现更新丢失问题</li>
<li>4：会对满足过滤条件的所有记录进行更新, 可以实现批量更新处理</li>
</ul>
<p>方案一：先查询再更新：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相关配置</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">"mysql://root:mysql@192.168.44.128:3306/test39"</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="literal">False</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_ECHO'</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建组件对象</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建模型类  商品表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goods</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">'t_good'</span>  <span class="comment"># 设置表名</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)  <span class="comment"># 设置主键</span></span><br><span class="line">    name = db.Column(db.String(<span class="number">20</span>), unique=<span class="literal">True</span>)  <span class="comment"># 商品名称</span></span><br><span class="line">    count = db.Column(db.Integer)  <span class="comment"># 剩余数量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">'/'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">purchase</span>():</span></span><br><span class="line">    <span class="string">"""购买商品"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 更新方式1: 先查询后更新</span></span><br><span class="line">    <span class="comment"># 缺点: 并发情况下, 容易出现更新丢失问题 (Lost Update)</span></span><br><span class="line">    <span class="comment"># 1.执行查询语句, 获取目标模型对象</span></span><br><span class="line">    goods = Goods.query.<span class="built_in">filter</span>(Goods.name == <span class="string">'方便面'</span>).first()</span><br><span class="line">    <span class="comment"># 2.对模型对象的属性进行赋值 (更新数据)</span></span><br><span class="line">    goods.count = goods.count - <span class="number">1</span></span><br><span class="line">    <span class="comment"># 3.提交会话</span></span><br><span class="line">    db.session.commit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"index"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 删除所有继承自db.Model的表</span></span><br><span class="line">    db.drop_all()</span><br><span class="line">    <span class="comment"># 创建所有继承自db.Model的表</span></span><br><span class="line">    db.create_all()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加一条测试数据</span></span><br><span class="line">    goods = Goods(name=<span class="string">'方便面'</span>, count=<span class="number">1</span>)</span><br><span class="line">    db.session.add(goods)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>方案二：配合查询过滤器filter() 和 更新执行器update() 进行数据更新</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Goods.query.<span class="built_in">filter</span>(Goods.name == <span class="string">'方便面'</span>).update({<span class="string">'count'</span>: Goods.count - <span class="number">1</span>})</span><br><span class="line">   db.session.commit()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="4、删除数据："><a href="#4、删除数据：" class="headerlink" title="4、删除数据："></a>4、删除数据：</h3><p>方案一：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式1: 先查后删除</span></span><br><span class="line">    goods = Goods.query.<span class="built_in">filter</span>(Goods.name == <span class="string">'方便面'</span>).first()</span><br><span class="line">    <span class="comment"># 删除数据</span></span><br><span class="line">    db.session.delete(goods)</span><br><span class="line">    <span class="comment"># 提交会话 增删改都要提交会话</span></span><br><span class="line">    db.session.commit()</span><br></pre></td></tr></tbody></table></figure>

<p>方案二：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式2: delete子查询</span></span><br><span class="line">    Goods.query.<span class="built_in">filter</span>(Goods.name == <span class="string">'方便面'</span>).delete()</span><br><span class="line">    <span class="comment"># 提交会话</span></span><br><span class="line">    db.session.commit()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="5、with-entities"><a href="#5、with-entities" class="headerlink" title="5、with_entities()"></a>5、with_entities()</h3><p>通过使用with_entities()方法来获取要在结果中返回的列</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询制定的id列</span></span><br><span class="line">result = User.query.with_entities(User.<span class="built_in">id</span>)  <span class="comment"># 返回BaseQuery</span></span><br><span class="line"><span class="comment"># sql打印</span></span><br><span class="line">SELECT t_user1.<span class="built_in">id</span> AS t_user1_id </span><br><span class="line">FROM t_user1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回指定的两列</span></span><br><span class="line">result = RiskDataModel.query.with_entities(RiskDataModel.<span class="built_in">id</span>, RiskDataModel.name)  </span><br><span class="line"><span class="comment"># sql打印</span></span><br><span class="line">SELECT t_user1.<span class="built_in">id</span> AS t_user1_id, t_user1.username AS t_user1_username </span><br><span class="line">FROM t_user1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并且去重</span></span><br><span class="line">result  = RiskDataModel.query.with_entities(RiskDataModel.store_st_id).distinct().<span class="built_in">all</span>()</span><br><span class="line"><span class="comment"># sql打印</span></span><br><span class="line">SELECT DISTINCT t_user1.<span class="built_in">id</span> AS t_user1_id </span><br><span class="line">FROM t_user1</span><br></pre></td></tr></tbody></table></figure>

<h3 id="6、count"><a href="#6、count" class="headerlink" title="6、count()"></a>6、count()</h3><p><code>count() </code>方法被用于确定返回的结果集中有多少行，让我们观察一下产生的SQL语句，SQLAlchemy先是取出符合条件的所有行集合，然后再通过 <code>SELECT count(*) </code>来统计有多少行。当然有点SQL知识的同学可能知道这条语句可以以更精简的方式写出来，比如 <code>SELECT count(*) FROM table </code>。</p>
<h5 id="2-1-原代码"><a href="#2-1-原代码" class="headerlink" title="2.1 原代码"></a>2.1 原代码</h5><p><strong>说明</strong>：进行了一次子查询，会生成临时表，效率低。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 统计当日登陆次数</span></span><br><span class="line">count = LoginLog.query.<span class="built_in">filter</span>(LoginLog.username == username, LoginLog.status == <span class="number">0</span>, db.cast(LoginLog.time, db.DATE) == db.cast(datetime.utcnow(), db.DATE)).count()</span><br><span class="line"></span><br><span class="line"><span class="comment"># sql打印</span></span><br><span class="line">SELECT</span><br><span class="line">    count(*) AS count_1</span><br><span class="line">FROM</span><br><span class="line">    (</span><br><span class="line">        SELECT</span><br><span class="line">            loginlog.<span class="built_in">id</span> AS loginlog_id,</span><br><span class="line">            loginlog.username AS loginlog_username,</span><br><span class="line">            loginlog.time AS loginlog_time,</span><br><span class="line">            loginlog. STATUS AS loginlog_status</span><br><span class="line">        FROM</span><br><span class="line">            loginlog</span><br><span class="line">        WHERE</span><br><span class="line">            loginlog.username = % (username_1) s</span><br><span class="line">        AND loginlog. STATUS = % (status_1) s</span><br><span class="line">        AND CAST(loginlog.time AS DATE) = CAST(%(param_1) s AS DATE)</span><br><span class="line">    ) AS anon_1</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h5 id="2-2-优化后"><a href="#2-2-优化后" class="headerlink" title="2.2 优化后"></a>2.2 优化后</h5><p><strong>说明</strong>：无子查询，效率高。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">count = db.session.query(func.count(LoginLog.<span class="built_in">id</span>)).<span class="built_in">filter</span>(LoginLog.username == username, LoginLog.status == <span class="number">0</span>, db.cast(LoginLog.time, db.DATE) == db.cast(datetime.utcnow(), db.DATE)).scalar()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sql打印</span></span><br><span class="line">SELECT</span><br><span class="line">    count(loginlog.<span class="built_in">id</span>) AS count_1</span><br><span class="line">FROM</span><br><span class="line">    loginlog</span><br><span class="line">WHERE</span><br><span class="line">    loginlog.username = % (username_1) s</span><br><span class="line">AND loginlog. STATUS = % (status_1) s</span><br><span class="line">AND CAST(loginlog.time AS DATE) = CAST(%(param_1) s AS DATE)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="7、join"><a href="#7、join" class="headerlink" title="7、join()"></a>7、join()</h3><p>使用join方法：查询用户id为4的姓名和地址（不在一张表），需要关联起来</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res=session.query(User).join(Address).<span class="built_in">filter</span>(User.<span class="built_in">id</span>==Address.user_id).<span class="built_in">filter</span>(User.<span class="built_in">id</span>==<span class="number">4</span>).first()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></tbody></table></figure>


<p>不使用join方法：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res=session.query(User.name,Address.email_address).<span class="built_in">filter</span>(User.<span class="built_in">id</span>==Address.user_id).first().name</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></tbody></table></figure>


<p>当不存在外键时，使用下面的方法进行读取数据</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res2=session.query.join(Address,User.<span class="built_in">id</span>==Address.user_id).<span class="built_in">filter</span>(Address.user_id==<span class="number">1</span>).first()</span><br><span class="line"><span class="built_in">print</span>(res2)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="三、高级机制："><a href="#三、高级机制：" class="headerlink" title="三、高级机制："></a>三、高级机制：</h2><h3 id="1、刷新数据："><a href="#1、刷新数据：" class="headerlink" title="1、刷新数据："></a>1、刷新数据：</h3><p>1：Session 被设计为数据操作的执行者, 会先将操作产生的数据保存到内存中。<br>2: 在执行 flush刷新操作 后, 数据操作才会同步到数据库中。<br>3：隐式刷新操作：1：提交会话 2：查询操作（包括更新和删除中的子查询）。<br>4：手动刷新：session.flush()<br>刷新机制的理解：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">答：刷新机制就是通过事务，将SQl语句执行一遍，然后将执行结果存储在变量中，但是数据库做回滚操作。导致变量中有了新值，但是数据库却没有改变。</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">goods = Goods(name=<span class="string">'方便面'</span>, count=<span class="number">20</span>)</span><br><span class="line">    db.session.add(goods)</span><br><span class="line">    <span class="comment"># 主动执行flush操作, 立即执行SQL操作(数据库同步)</span></span><br><span class="line">    <span class="built_in">print</span>(goods.<span class="built_in">id</span>)  <span class="comment"># 此时是None</span></span><br><span class="line">    db.session.flush()</span><br><span class="line">	<span class="built_in">print</span>(goods.<span class="built_in">id</span>) <span class="comment"># 此时是1</span></span><br><span class="line">    <span class="comment"># Goods.query.count()  # 查询操作会自动执行flush操作</span></span><br><span class="line">    db.session.commit()  <span class="comment"># 提交会话会自动执行flush操作</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2、多表查询："><a href="#2、多表查询：" class="headerlink" title="2、多表查询："></a>2、多表查询：</h3><h3 id="2-1-外键关联查询："><a href="#2-1-外键关联查询：" class="headerlink" title="2.1 外键关联查询："></a>2.1 外键关联查询：</h3><ul>
<li>生成主表对象后，必须刷新数据库，否则后面无法使用主表对象的属性。</li>
</ul>
<p>1、主从表的定义：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户表  一   一个用户可以有多个地址</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">'t_user'</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 地址表   多</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">'t_adr'</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    detail = db.Column(db.String(<span class="number">20</span>))</span><br><span class="line">    user_id = db.Column(db.Integer)  <span class="comment"># 定义外键</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2：添加关联数据：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="string">"""添加并关联数据"""</span></span><br><span class="line"></span><br><span class="line">    user1 = User(name=<span class="string">'张三'</span>)</span><br><span class="line">    db.session.add(user1)</span><br><span class="line">    db.session.flush()  <span class="comment"># 必须刷新，不然后面的user1.id是None</span></span><br><span class="line">    adr1 = Address(detail=<span class="string">'中关村3号'</span>, user_id=user1.<span class="built_in">id</span>)</span><br><span class="line">    adr2 = Address(detail=<span class="string">'华强北5号'</span>, user_id=user1.<span class="built_in">id</span>)</span><br><span class="line">    db.session.add_all([adr1, adr2])</span><br><span class="line">    db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"index"</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3：关联查询：</p>
<figure class="highlight plaintext"><figcaption><span>y</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 1.先根据姓名查找到主表主键</span><br><span class="line">    user1 = User.query.filter_by(name='张三').first()</span><br><span class="line"></span><br><span class="line">    # 2.再根据主键到从表查询关联地址</span><br><span class="line">    adrs = Address.query.filter_by(user_id=user1.id).all()</span><br><span class="line">    for adr in adrs:</span><br><span class="line">        print(adr.detail)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>















</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Flask-Sqlalchemy的基本使用</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://www.zhangxiaotao.live/2021/12/16/Flask/SqlAlchemy/01%20Flask-Sqlalchemy%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">http://www.zhangxiaotao.live/2021/12/16/Flask/SqlAlchemy/01%20Flask-Sqlalchemy%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="display: inline-block;width: 120px"><h>作者</h><div class="post-copyright-cc-info"><h>John Doe</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 120px"><h>发布于</h><div class="post-copyright-cc-info"><h>2021-12-16</h></div></div><div class="post-copyright-u" style="display: inline-block;width: 120px"><h>更新于</h><div class="post-copyright-cc-info"><h>2022-07-01</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 120px"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Flask/">Flask</a></div><div class="post_share"><div class="social-share" data-image="https://img0.baidu.com/it/u=1259925066,3370431306&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG?w=819&amp;h=500" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/16/Flask/Flask%E5%9F%BA%E7%A1%80/10%20Flask%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><img class="prev-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20190909%2F914b18a442db4f1dba4342c0f9478ded.jpeg&amp;refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1649234474&amp;t=f2d7f98d5bd12c17bfd74eb1ccc96557" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Flask源码分析</div></div></a></div><div class="next-post pull-right"><a href="/2021/12/16/Flask/Flask%E5%9F%BA%E7%A1%80/00-00%20Flask%E6%B1%87%E6%80%BB/"><img class="next-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20190909%2F914b18a442db4f1dba4342c0f9478ded.jpeg&amp;refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1649234474&amp;t=f2d7f98d5bd12c17bfd74eb1ccc96557" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Flask汇总</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/04/24/Flask/Flask-APScheduler/Flask-APScheduler/" title="Flask-Sqlalchemy"><img class="cover" src="https://img2.baidu.com/it/u=1361381631,22441392&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG?w=500&amp;h=354" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-24</div><div class="title">Flask-Sqlalchemy</div></div></a></div><div><a href="/2022/04/20/Flask/Flask-APScheduler/%E4%BD%BF%E7%94%A8flask-apscheduler%E6%8E%A7%E5%88%B6%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" title="使用flask-apscheduler控制定时任务"><img class="cover" src="https://img2.baidu.com/it/u=1361381631,22441392&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=PNG?w=500&amp;h=354" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-20</div><div class="title">使用flask-apscheduler控制定时任务</div></div></a></div><div><a href="/2021/12/16/Flask/Flask%E5%9F%BA%E7%A1%80/02-01%20%E8%AF%A6%E8%A7%A3url%20/" title="详解url"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20190909%2F914b18a442db4f1dba4342c0f9478ded.jpeg&amp;refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1649234474&amp;t=f2d7f98d5bd12c17bfd74eb1ccc96557" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-16</div><div class="title">详解url</div></div></a></div><div><a href="/2021/12/16/Flask/Flask%E5%9F%BA%E7%A1%80/03-01%20HTTP%E8%AF%B7%E6%B1%82%20/" title="HTTP请求"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20190909%2F914b18a442db4f1dba4342c0f9478ded.jpeg&amp;refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1649234474&amp;t=f2d7f98d5bd12c17bfd74eb1ccc96557" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-16</div><div class="title">HTTP请求</div></div></a></div><div><a href="/2021/12/16/Flask/Flask%E5%9F%BA%E7%A1%80/03-02%20%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%E5%92%8C%E8%A7%86%E5%9B%BE%E7%B1%BB/" title="视图函数和视图类"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20190909%2F914b18a442db4f1dba4342c0f9478ded.jpeg&amp;refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1649234474&amp;t=f2d7f98d5bd12c17bfd74eb1ccc96557" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-16</div><div class="title">视图函数和视图类</div></div></a></div><div><a href="/2021/12/16/Flask/Flask%E5%9F%BA%E7%A1%80/06-01%20Flask_%E8%84%9A%E6%9C%AC%20/" title="Flask_脚本"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20190909%2F914b18a442db4f1dba4342c0f9478ded.jpeg&amp;refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1649234474&amp;t=f2d7f98d5bd12c17bfd74eb1ccc96557" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-16</div><div class="title">Flask_脚本</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://picture-typora-bucket.oss-cn-shanghai.aliyuncs.com/typora/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">John Doe</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">399</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">40</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">48</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zhzhang12138"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my blog   <img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/pig.gif"></div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">一、基本使用：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%8E%AF%E5%A2%83%E7%9A%84%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">1、环境的安装：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">二、数据操作：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">1.1、增加数据：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81%E6%89%B9%E9%87%8F%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">1.2、批量增加数据：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">2.2.1.</span> <span class="toc-text">第一种方法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">2.2.2.</span> <span class="toc-text">第二种方法：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-number">2.3.</span> <span class="toc-text">2、查询数据：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.3.1.</span> <span class="toc-text">数据的准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.2.</span> <span class="toc-text">进行查询操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2-filter-by%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">查询:filter_by精确查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#first-%E8%BF%94%E5%9B%9E%E6%9F%A5%E8%AF%A2%E5%88%B0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">first()返回查询到的第一个对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#all-%E8%BF%94%E5%9B%9E%E6%9F%A5%E8%AF%A2%E5%88%B0%E7%9A%84%E6%89%80%E6%9C%89%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">all()返回查询到的所有对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#filter%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%90%8D%E5%AD%97%E7%BB%93%E5%B0%BE%E5%AD%97%E7%AC%A6%E4%B8%BAg%E7%9A%84%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E3%80%82"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">filter模糊查询，返回名字结尾字符为g的所有数据。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#get-%EF%BC%8C%E5%8F%82%E6%95%B0%E4%B8%BA%E4%B8%BB%E9%94%AE%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%BB%E9%94%AE%E4%B8%8D%E5%AD%98%E5%9C%A8%E6%B2%A1%E6%9C%89%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9"><span class="toc-number">2.3.2.5.</span> <span class="toc-text">get()，参数为主键，如果主键不存在没有返回内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E9%9D%9E%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%90%8D%E5%AD%97%E4%B8%8D%E7%AD%89%E4%BA%8Ewang%E7%9A%84%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E3%80%82"><span class="toc-number">2.3.2.6.</span> <span class="toc-text">逻辑非，返回名字不等于wang的所有数据。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E4%B8%8E%EF%BC%8C%E9%9C%80%E8%A6%81%E5%AF%BC%E5%85%A5and%EF%BC%8C%E8%BF%94%E5%9B%9Eand-%E6%9D%A1%E4%BB%B6%E6%BB%A1%E8%B6%B3%E7%9A%84%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E3%80%82"><span class="toc-number">2.3.2.7.</span> <span class="toc-text">逻辑与，需要导入and，返回and()条件满足的所有数据。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%88%96%EF%BC%8C%E9%9C%80%E8%A6%81%E5%AF%BC%E5%85%A5or"><span class="toc-number">2.3.2.8.</span> <span class="toc-text">逻辑或，需要导入or_</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#not-%E7%9B%B8%E5%BD%93%E4%BA%8E%E5%8F%96%E5%8F%8D"><span class="toc-number">2.3.2.9.</span> <span class="toc-text">not_ 相当于取反</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%90%8E%E5%88%A0%E9%99%A4"><span class="toc-number">2.3.2.10.</span> <span class="toc-text">查询数据后删除</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.2.11.</span> <span class="toc-text">更新数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8update"><span class="toc-number">2.3.2.12.</span> <span class="toc-text">使用update</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-number">2.4.</span> <span class="toc-text">3、修改数据：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-number">2.5.</span> <span class="toc-text">4、删除数据：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81with-entities"><span class="toc-number">2.6.</span> <span class="toc-text">5、with_entities()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81count"><span class="toc-number">2.7.</span> <span class="toc-text">6、count()</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%8E%9F%E4%BB%A3%E7%A0%81"><span class="toc-number">2.7.0.1.</span> <span class="toc-text">2.1 原代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E4%BC%98%E5%8C%96%E5%90%8E"><span class="toc-number">2.7.0.2.</span> <span class="toc-text">2.2 优化后</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81join"><span class="toc-number">2.8.</span> <span class="toc-text">7、join()</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%AB%98%E7%BA%A7%E6%9C%BA%E5%88%B6%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">三、高级机制：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%B7%E6%96%B0%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">1、刷新数据：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%9A"><span class="toc-number">3.2.</span> <span class="toc-text">2、多表查询：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%A4%96%E9%94%AE%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%EF%BC%9A"><span class="toc-number">3.3.</span> <span class="toc-text">2.1 外键关联查询：</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/07/04/zookeeper/00%20Zookeeper%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88/" title="Zookeeper可以做什么"><img src="https://img1.baidu.com/it/u=278258402,1585112533&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=456" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Zookeeper可以做什么"></a><div class="content"><a class="title" href="/2022/07/04/zookeeper/00%20Zookeeper%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88/" title="Zookeeper可以做什么">Zookeeper可以做什么</a><time datetime="2022-07-04T01:44:00.000Z" title="发表于 2022-07-04 09:44:00">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/04/zookeeper/02%20%E4%BD%BF%E7%94%A8python%E6%93%8D%E4%BD%9Czookeeper/" title="Zookeeper可以做什么"><img src="https://img1.baidu.com/it/u=278258402,1585112533&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=456" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Zookeeper可以做什么"></a><div class="content"><a class="title" href="/2022/07/04/zookeeper/02%20%E4%BD%BF%E7%94%A8python%E6%93%8D%E4%BD%9Czookeeper/" title="Zookeeper可以做什么">Zookeeper可以做什么</a><time datetime="2022-07-04T01:44:00.000Z" title="发表于 2022-07-04 09:44:00">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/01/%E7%88%AC%E8%99%AB/08%20%E5%9F%BA%E4%BA%8EPython%20+Selenium%E7%9A%84%E7%88%AC%E8%99%AB%E8%AF%A6%E8%A7%A3/" title="无题"><img src="/transparent" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"></a><div class="content"><a class="title" href="/2022/07/01/%E7%88%AC%E8%99%AB/08%20%E5%9F%BA%E4%BA%8EPython%20+Selenium%E7%9A%84%E7%88%AC%E8%99%AB%E8%AF%A6%E8%A7%A3/" title="无题">无题</a><time datetime="2022-07-01T08:40:03.232Z" title="发表于 2022-07-01 16:40:03">2022-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/01/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/04%20Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理"><img src="https://img1.baidu.com/it/u=278258402,1585112533&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=456" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx反向代理"></a><div class="content"><a class="title" href="/2022/07/01/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/04%20Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理">Nginx反向代理</a><time datetime="2022-07-01T06:41:00.000Z" title="发表于 2022-07-01 14:41:00">2022-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/01/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/02%20Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/" title="Nginx配置文件详解"><img src="https://img1.baidu.com/it/u=278258402,1585112533&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=456" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx配置文件详解"></a><div class="content"><a class="title" href="/2022/07/01/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/02%20Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/" title="Nginx配置文件详解">Nginx配置文件详解</a><time datetime="2022-07-01T06:41:00.000Z" title="发表于 2022-07-01 14:41:00">2022-07-01</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2020 - 2022 <i id="heartbeat" class="fa fas fa-heartbeat"></i>  John Doe</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})
setTimeout(function(){preloader.endLoading();}, 3000);</script></div><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/timing.js"></script><script src="https://cdn.jsdelivr.net/gh/weilain/cdn-photo/js/jquery.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script type="text/javascript" src="/js/crash_cheat.js"></script></body></html>